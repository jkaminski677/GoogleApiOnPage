<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Drive Explorer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="innerBody">
        <div id="container">

            <div id="leftPanel">
                <h2>Google Drive Explorer</h2>
                <button onclick="listFiles()">Pokaż pliki w folderze</button>
                <div id="innerLeftPanel">
                    <ul id="fileList"></ul>
                </div>
                
            </div>
            <div id="rightPanel">
                <div>
                    <button onclick="goToParentFolder()">Powrót do folderu nadrzędnego</button>
                    <h2 id="folderTitle"></h2>
                    <ul id="folderContent"></ul>
                </div>
                <div id="fileViewer"></div>
            </div>

        </div>
        
    </div>
    

    <script>
        // Zmienne związane z Google Drive API
        const CLIENT_ID = '651449741883-e2lqdofq9i78j4tciiqu2mm2q918ina3.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyB9fIJi2vQWEr-pHfTAdII_jpXDe5AjEnI';
        const ROOT_FOLDER_ID = '179ezGslqWjoSMJ4rFK45A5jDZu8TbS_r';

        let currentFolderId = ROOT_FOLDER_ID;

        function listFiles(folderId = ROOT_FOLDER_ID, parentNode = null) {

            // Zapisz bieżący folder
            currentFolderId = folderId;

            // Żądanie do Google Drive API
            fetch(`https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents&key=${API_KEY}`)
                .then(response => response.json())
                .then(data => {
                    displayFiles(data.files, parentNode, folderId);
                })
                .catch(error => console.error('Błąd pobierania plików:', error));


            
        }

        function displayFiles(files, parentNode, folderId) {
            const fileListElement = document.getElementById('fileList');
            const folderContentElement = document.getElementById('folderContent');
            const folderTitleElement = document.getElementById('folderTitle');
            const fileViewerElement = document.getElementById('fileViewer');

            // Wyczyszczenie widoku pliku
            fileViewerElement.innerHTML = '';

            if (!parentNode) {
                fileListElement.innerHTML = ''; // Wyczyszczenie listy przed aktualizacją
            }

            if (files && files.length > 0) {
                files.forEach(file => {
                    if (file.mimeType === 'application/vnd.google-apps.folder') {
                        // Jeśli to folder, utwórz nowy element listy z klasą 'folder'
                        const folderItem = document.createElement('li');
                        folderItem.className = 'folder';
                        folderItem.textContent = `${file.name} `;
                        
                        // Dodaj folder jako element nadrzędny dla kolejnych plików
                        if (parentNode) {
                            parentNode.appendChild(folderItem);
                        } else {
                            fileListElement.appendChild(folderItem);
                        }

                        // Dodaj obsługę kliknięcia na folder
                        folderItem.addEventListener('click', () => {
                            folderContentElement.innerHTML = ''; // Wyczyszczenie prawego panelu
                            folderTitleElement.textContent = file.name; // Ustawienie tytułu folderu

                            // Rekurencyjnie wywołaj listFiles dla tego foldera
                            listFiles(file.id, folderContentElement);
                        });
                    } else {
                        // Jeśli to plik, dodaj jako element listy
                        const listItem = document.createElement('li');
                        const fileLink = document.createElement('a');
                        fileLink.textContent = file.name;
                        
                        // Dodaj obsługę kliknięcia na plik
                        fileLink.addEventListener('click', () => {
                            // Wyświetl zawartość pliku w prawym panelu
                            displayFileContent(file, fileViewerElement);
                        });
                        
                        listItem.appendChild(fileLink);
                        
                        // Dodaj do odpowiedniego foldera (jeśli jest)
                        if (parentNode) {
                            parentNode.appendChild(listItem);
                        } else {
                            fileListElement.appendChild(listItem);
                        }
                    }
                });
            } else {
                const emptyMessage = document.createElement('p');
                emptyMessage.textContent = 'Brak plików w folderze.';
                
                if (parentNode) {
                    parentNode.appendChild(emptyMessage);
                } else {
                    fileListElement.appendChild(emptyMessage);
                }
            }

        }

        function displayFileContent(file, fileViewerElement) {
            if (file.mimeType === 'application/pdf') {
                // Obsługa pliku PDF
                fileViewerElement.innerHTML = `<iframe src="https://drive.google.com/file/d/${file.id}/preview" width="100%" height="100%"></iframe>`;
            } else if (file.mimeType.startsWith('audio/')) {
                // Obsługa pliku dźwiękowego (np. MP3)
                fileViewerElement.innerHTML = `<audio controls><source src="https://drive.google.com/uc?id=${file.id}" type="${file.mimeType}"></audio>`;
            } else {
                // Inne typy plików - do zaimplementowania dla konkretnych formatów
                fileViewerElement.innerHTML = `<p>Podgląd pliku "${file.name}" nie jest obsługiwany.</p>`;
            }
        }

        function goToParentFolder() {
            // // Znajdź ID folderu nadrzędnego (jeśli nie jest to główny folder)
            // if (currentFolderId !== ROOT_FOLDER_ID) {
            //     fetch(`https://www.googleapis.com/drive/v3/files/${currentFolderId}?key=${API_KEY}`)
            //         .then(response => response.json())
            //         .then(data => {
            //             if (data.parents && data.parents.length > 0) {
            //                 const parentId = data.parents[0];
            //                 listFiles(parentId);
            //             }
            //         })
            //         .catch(error => console.error('Błąd pobierania folderu nadrzędnego:', error));
            // }
            // Dodano sprawdzenie, czy panel na górze jest na całą szerokość
        }


    </script>
</body>
</html>
